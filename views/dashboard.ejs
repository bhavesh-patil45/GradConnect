<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>GradConnect Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

  <style>
    body {
      font-family: 'Inter', sans-serif;
    }

    .section.hidden {
      display: none;
    }

    .nav-icon {
      transition: transform 0.2s, color 0.2s;
    }

    .nav-icon.active {
      color: #2563eb;
      transform: scale(1.2);
    }

    @media (max-width: 768px) {
      aside {
        position: fixed;
        bottom: 0;
        left: 0;
        width: 100%;
        height: 60px;
        flex-direction: row;
        justify-content: space-around;
        border-top: 1px solid #e5e7eb;
        box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.05);
      }

      main {
        padding-bottom: 80px;
      }
    }
  </style>
</head>

<body class="bg-gray-100">

  <!-- Header -->
  <header class="bg-white shadow flex justify-between items-center px-6 py-4">
    <span onclick="showSection('home')" class="text-2xl font-bold text-blue-600 cursor-pointer">GradConnect</span>
    <p class="text-sm text-gray-600">Welcome, <%= name %> (<%= role %>)</p>
    <a href="/logout" class="hover:opacity-80">
      <img src="/images/logout.jpg" class="h-8 w-8" alt="Logout" />
    </a>
  </header>

  <div class="flex h-[calc(100vh-64px)]">
    <!-- Sidebar -->
    <aside class="w-20 bg-white shadow flex flex-col items-center py-6 space-y-6">
      <button onclick="showSection('home', this)" class="nav-icon text-2xl hover:text-blue-600 active"
        title="Home">üè†</button>
      <button onclick="showSection('notifications', this)" class="nav-icon text-2xl hover:text-blue-600"
        title="Notifications">üîî</button>
      <button onclick="showSection('chat', this)" class="nav-icon text-2xl hover:text-blue-600" title="Chat">üí¨</button>
      <button onclick="showSection('post', this)" class="nav-icon text-2xl hover:text-blue-600" title="Post">‚ûï</button>
      <button onclick="showSection('jobs', this)" class="nav-icon text-2xl hover:text-blue-600" title="Jobs">üíº</button>
      <button onclick="showSection('profile', this)" class="nav-icon text-2xl hover:text-blue-600"
        title="Profile">üë§</button>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 overflow-y-auto p-6 space-y-6">

      <!-- Home Section -->
      <section id="home" class="section">
        <h2 class="text-xl font-bold mb-4">Home Feed</h2>

        <div class="space-y-6">
          <% if (posts && posts.length> 0) { %>
            <% posts.forEach(post=> { %>
              <div class="bg-white rounded-lg shadow p-4 space-y-3">
                <div class="flex items-center space-x-3">
                  <img src="<%= post.userId?.profileImage || '/images/default-avatar.png' %>"
                    class="w-10 h-10 rounded-full border">
                  <div>
                    <p class="font-semibold">
                      <%= post.userId?.name || post.userId?.username || 'Unknown User' %>
                    </p>
                    <small class="text-gray-500">
                      <%= post.createdAt ? post.createdAt.toDateString() : '' %>
                    </small>
                  </div>
                </div>

                <p class="text-gray-800">
                  <%= post.caption %>
                </p>

                <% if (post.image) { %>
                  <img src="<%= post.image %>" class="rounded-lg w-full object-contain max-h-[500px]" />
                  <% } %>

                    <div class="flex space-x-4 text-sm text-gray-600 mt-2">
                      <form action="/post/<%= post._id %>/like" method="POST">
                        <button type="submit">‚ù§Ô∏è <%= post.likes || 0 %> Likes</button>
                      </form>
                      <span>üí¨ <%= post.comments?.length || 0 %> Comments</span>
                    </div>

                    <ul class="space-y-1 text-sm text-gray-700">
                      <% (post.comments || []).forEach(comment=> { %>
                        <li>
                          <strong>
                            <%= comment.user?.name || 'User' %>:
                          </strong>
                          <%= comment.text %>
                        </li>
                        <% }) %>
                    </ul>

                    <form action="/post/<%= post._id %>/comment" method="POST" class="mt-2 space-y-2">
                      <input name="text" placeholder="Add a comment..." class="border rounded w-full p-2" required>
                      <button class="text-blue-600 hover:underline">Comment</button>
                    </form>
              </div>
              <% }) %>
                <% } else { %>
                  <p class="text-gray-600">No posts yet.</p>
                  <% } %>
        </div>
      </section>

      <!-- Notifications -->
      <section id="notifications" class="section hidden">
        <h2 class="text-xl font-bold mb-4">Notifications</h2>
        <% if (notifications && notifications.length> 0) { %>
          <ul class="space-y-3">
            <% notifications.forEach(note=> { %>
              <li class="bg-white shadow p-3 rounded">
                <%= note.message %>
              </li>
              <% }) %>
          </ul>
          <% } else { %>
            <p class="text-gray-600">You currently have no new notifications.</p>
            <% } %>
      </section>

      <!-- Chat -->
      <section id="chat" class="section hidden">
        <h2 class="text-xl font-bold mb-4">Chat</h2>
        <p class="text-gray-600">Chat feature coming soon.</p>
      </section>

      <!-- Create Post -->
      <section id="post" class="section hidden bg-white p-6 rounded-lg shadow max-w-lg mx-auto transition-all">
        <h2 class="text-center text-2xl font-bold text-gray-800 mb-4">Create a Post</h2>
        <form action="/post/create" method="POST" enctype="multipart/form-data" class="space-y-4">
          <textarea name="caption" placeholder="Write something..." required
            class="border rounded-lg w-full p-3 h-28 resize-none focus:border-blue-500 outline-none"></textarea>

          <input type="file" name="image"
            class="border border-dashed border-gray-400 w-full p-3 rounded-lg bg-gray-50 hover:border-blue-400 transition">

          <button type="submit"
            class="bg-blue-600 text-white px-5 py-2 rounded-lg font-semibold hover:bg-blue-700 transition w-full">Post</button>
        </form>
      </section>

      <!-- for the job posting -->
      <section id="jobs" class="section hidden">
        <h2 class="text-xl font-bold mb-4">Jobs</h2>

        <% if(role==='Admin' || role==='Alumni' || role==='Student' ) { %>
          <!-- Job Creation Form -->
          <div class="bg-white p-6 rounded-lg shadow mb-6">
            <h3 class="text-lg font-semibold mb-4">Create a Job Post</h3>
            <form action="/job/create" method="POST" class="space-y-3">
              <input type="text" name="title" placeholder="Job Title" class="border p-2 rounded w-full" required>
              <input type="text" name="company" placeholder="Company Name" class="border p-2 rounded w-full" required>
              <input type="text" name="location" placeholder="Location" class="border p-2 rounded w-full">
              <textarea name="description" placeholder="Job Description" class="border p-2 rounded w-full"></textarea>
              <input type="url" name="applyLink" placeholder="Application Link (https://...)"
                class="border p-2 rounded w-full" required>
              <button class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition">Post Job</button>
            </form>
          </div>
          <% } %>

            <!-- Job Listings -->
            <% if (jobs && jobs.length> 0) { %>
              <div class="space-y-4">
                <% jobs.forEach(job=> { %>
                  <div class="bg-white p-4 rounded-lg shadow flex justify-between items-start space-x-4">
                    <div>
                      <h3 class="text-lg font-semibold">
                        <%= job.title %>
                      </h3>
                      <p class="text-gray-600">
                        <%= job.company %> - <%= job.location || 'Remote' %>
                      </p>
                      <p class="text-gray-700 mt-2">
                        <%= job.description %>
                      </p>
                    </div>
                    <div class="flex flex-col justify-center">
                      <a href="<%= job.applyLink %>" target="_blank"
                        class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 transition">Apply</a>
                    </div>
                  </div>
                  <% }) %>
              </div>
              <% } else { %>
                <p class="text-gray-600">No jobs posted yet.</p>
                <% } %>
      </section>


      <!-- Profile Section -->
      <section id="profile" class="section hidden">
        <div class="max-w-4xl mx-auto bg-white rounded-lg shadow p-6 space-y-6">

          <!-- Header -->
          <div class="flex items-center space-x-6">
            <div class="relative">
              <img id="profilePreview" src="<%= user.profileImage || '/images/default-avatar.png' %>"
                class="w-32 h-32 rounded-full border object-cover">
            </div>
            <div>
              <h2 class="text-2xl font-semibold">
                <%= user.name %>
              </h2>
              <p class="text-gray-600">
                <%= user.designation || 'No designation' %> @ <%= user.currentCompany || 'N/A' %>
              </p>
              <p class="text-gray-500 text-sm">
                <%= user.email %>
              </p>
            </div>
          </div>

          <!-- About -->
          <div>
            <h3 class="text-lg font-semibold mb-2">About</h3>
            <p class="text-gray-700">
              <%= user.bio || 'No bio yet.' %>
            </p>
          </div>

          <!-- Edit Profile -->
          <div>
            <h3 class="text-lg font-semibold mb-2">Edit Profile</h3>
            <form action="/profile/update" method="POST" enctype="multipart/form-data" class="space-y-3">
              <input type="text" name="currentCompany" value="<%= user.currentCompany %>" placeholder="Current Company"
                class="border rounded w-full p-2">
              <input type="text" name="designation" value="<%= user.designation %>" placeholder="Designation"
                class="border rounded w-full p-2">
              <textarea name="bio" placeholder="Add a short bio..."
                class="border rounded w-full p-2"><%= user.bio %></textarea>
              <input type="file" name="profileImage" class="border rounded w-full p-2" accept="image/*"
                onchange="previewProfile(event)">
              <button class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition">Update</button>
            </form>
          </div>

          <!-- Experience -->
          <div>
            <h3 class="text-lg font-semibold mb-2">Experience</h3>
            <% if (user.experience && user.experience.length> 0) { %>
              <div class="space-y-3">
                <% user.experience.forEach(exp=> { %>
                  <div class="border p-3 rounded">
                    <p class="font-semibold">
                      <%= exp.position %> at <%= exp.company %>
                    </p>
                    <p class="text-gray-600 text-sm">
                      <%= exp.startDate %> - <%= exp.endDate || 'Present' %>
                    </p>
                    <p class="text-gray-700">
                      <%= exp.description %>
                    </p>
                  </div>
                  <% }) %>
              </div>
              <% } else { %>
                <p class="text-gray-600">No experience added yet.</p>
                <% } %>

                  <!-- Add Experience -->
                  <form action="/profile/experience" method="POST" class="mt-4 space-y-3">
                    <input type="text" name="company" placeholder="Company" class="border rounded w-full p-2" required>
                    <input type="text" name="position" placeholder="Position" class="border rounded w-full p-2"
                      required>
                    <div class="flex space-x-3">
                      <input type="text" name="startDate" placeholder="Start Date" class="border rounded w-full p-2"
                        required>
                      <input type="text" name="endDate" placeholder="End Date (or Present)"
                        class="border rounded w-full p-2">
                    </div>
                    <textarea name="description" placeholder="Describe your role"
                      class="border rounded w-full p-2"></textarea>
                    <button class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 transition">Add
                      Experience</button>
                  </form>
          </div>
        </div>
      </section>
    </main>
  </div>

  <script>
    function showSection(id, element) {
      document.querySelectorAll('.section').forEach(sec => sec.classList.add('hidden'));
      const section = document.getElementById(id);
      if (!section) return;
      section.classList.remove('hidden');
      gsap.fromTo(section, { opacity: 0 }, { opacity: 1, duration: 0.5 });
      document.querySelectorAll('.nav-icon').forEach(icon => icon.classList.remove('active'));
      if (element) element.classList.add('active');
    }

    window.onload = function () {
      gsap.from("header", { opacity: 0, y: -50, duration: 1 });
      gsap.from("aside", { opacity: 0, x: -100, duration: 1, delay: 0.5 });
    };
  </script>
</body>

</html>